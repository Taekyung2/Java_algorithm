#include<stdio.h>
int N, M,x,y,m,max;
int map[40][40],visit[40],st[40],top=-1,ans[40],at;
struct aa{
    char q[5];
    int b;
    int c;
}po[40];
 
void dfs(int now,int d,int s){
    int i,j,k=0;
 
    for (i = 2; i <= x + 1; i++){
        if (visit[i] == 0 &&map[now][i]+d+po[i].b<=540){
            visit[i] = 1;           
            k = 1;
            st[++top] = i;
            dfs(i, d + map[now][i] + po[i].b, s + po[i].c);
            visit[i] = 0;
            --top;
        }
    }
    if (m == M){
        if (map[now][1] + d <= 540){
            if (max < s){
                max = s;
                for (i = 0; i <= top; i++) ans[i] = st[i];
                at = top;
            }
        }
        else return;
    }
    else if (!k){
        for (i = x + 2; i <= N; i++){
            if (map[now][i] + d <= 540){
                m++;
                st[++top] = i;
                dfs(i, 0, s);
                m--;
                --top;
            }
        }
    }
}
int main()
{
    int T, i, j, k, a;
    char w[10];
    //freopen("input.txt", "r", stdin);
    scanf("%d", &T);
    for (i = 1; i <= T; i++){
        scanf("%d %d", &N, &M);
        for (j = 1; j < N; j++){
            for (k = j + 1; k <= N; k++){
                scanf("%d", &a);
                map[j][k] = a;
                map[k][j] = a;
            }
        }
         
        x = 0;
        for (j = 1; j <= N; j++){
            scanf("%s", &po[j].q);
            if (po[j].q[0] == 'P'){
                scanf("%d %d", &po[j].b, &po[j].c);
                x++;
            }
        }
        max = 0;
        m = 1;
        dfs(1,0,0);
        printf("#%d %d ", i, max);
        if (max != 0){
            for (j = 0; j <= at; j++) printf("%d ", ans[j]);
            printf("1");
        }
        printf("\n");
    }
    return 0;
}